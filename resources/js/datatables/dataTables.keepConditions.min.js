"use strict";function _typeof(t){return t&&"undefined"!=typeof Symbol&&t.constructor===Symbol?"symbol":typeof t}function _classCallCheck(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(n,e,i){return e&&t(n.prototype,e),i&&t(n,i),n}}(),KeepConditions=function(){function t(n){if(_classCallCheck(this,t),!$.fn.DataTable.isDataTable(n)&&!n instanceof $.fn.dataTable.Api)throw new Error("Failed to initialize KeepConditions plugin on non-datatable object");n instanceof $.fn.dataTable.Api?this._dtApi=n:this._dtApi=new $.fn.dataTable.Api(n),n=this._dtApi.settings()[0],this._dtSettings=n,this._tableId=$(this._dtApi.table().node()).attr("id"),this._dtDefaults=$.fn.dataTable.defaults,this._keysToCons=this._keyMap(),this._shouldDraw=!1,this._enabledConditions=[],this._eventNamespace="keepConditions",n.oKeepConditions=this,this._init()}return _createClass(t,[{key:"_init",value:function(){this._collectEnabled(),(this._dtSettings.oInit.keepConditions===!0||"string"==typeof this._dtSettings.oInit.keepConditions||$.isArray(this._dtSettings.oInit.keepConditions)||$.isPlainObject(this._dtSettings.oInit.keepConditions)&&("undefined"==typeof this._dtSettings.oInit.keepConditions.attachEvents||this._dtSettings.oInit.keepConditions.attachEvents===!0))&&this.attachEvents(),this.processHash()}},{key:"_collectEnabled",value:function(){var t=this;$.each(this.conditions(),function(n,e){t._isEnabled(n)&&e.isInit()&&t.enableCondition(n)})}},{key:"_keyMap",value:function(){return function(t){var n={};return $.each(t,function(t,e){n[e.key]=t}),n}(this.conditions())}},{key:"_isEnabled",value:function(t){var n=this._dtSettings.oInit.keepConditions;if(1===t.length){var e=this.nameByKey(t);if(!t)throw new Error("Unable to find an existing condition with the key '"+t+"'");t=e}else if(this.conditions(t)===!1)throw new Error("Unable to find an existing condition with the name '"+t+"'");return n===!0||"undefined"==typeof n||"string"==typeof n&&-1!==n.indexOf(this.conditions(t).key)||$.isArray(n)&&-1!==$.inArray(t,n)||$.isPlainObject(n)&&$.isArray(n.conditions)&&-1!==$.inArray(t,n.conditions)||$.isPlainObject(n)&&"string"==typeof n.conditions&&-1!==n.conditions.indexOf(this.conditions(t).key)}},{key:"_drawTable",value:function(t,n){(this._shouldDraw===!0||t===!0)&&(this._dtApi.draw(n===!0),this._shouldDraw=!1)}},{key:"_lang",value:function(t,n){}},{key:"structureHash",value:function(n){return t.structureHash(this._dtSettings,n)}},{key:"dtSettings",value:function(){return this._dtSettings}},{key:"attachEvents",value:function(){var n=this,e={dtSettings:this._dtSettings},i=this.getEnabledConditions();if(i===!1)throw new Error("No enabled conditions to attach to events");var o=this.conditions(i);$.each(o,function(i,o){n._dtApi.on(o.event+"."+n._eventNamespace,e,t.structureHash.bind(t))})}},{key:"detachEvents",value:function(){var t=this,n=({dtSettings:this._dtSettings},this.getEnabledConditions());if(n===!1)throw new Error("No enabled conditions to attach to events");var e=this.conditions(n);$.each(e,function(n,e){t._isEnabled(n)&&e.isInit()&&t._dtApi.off(e.event+"."+t._eventNamespace)})}},{key:"detachEvent",value:function(n){var e=this;if("undefined"==typeof n)return void console.warn("No condition or event specified for KeepConditions.detachEvent(), nothing is getting detached");var i=this.conditions(n);if(!i)return!1;var o;"string"==typeof n?(o=n.endsWith(".dt")?n:i.event,this._dtApi.off(o,t.structureHash.bind(t))):$.isArray(n)&&n.length>0?$.each(n,function(t,n){if(n.endsWith(".dt"))o=n;else{if("undefined"==typeof i[n])throw new Error("Unknown condition specified: "+n);o=i[n].event}e._dtApi.off(o+"."+e._eventNamespace)}):console.warn("Illegal parameter type for KeepConditions.detachEvent(), should be array or string, was: ","undefined"==typeof n?"undefined":_typeof(n))}},{key:"attachEvent",value:function(n){var e=this;if("undefined"==typeof n)return void console.warn("No condition or event specified for KeepConditions.attachEvent(), nothing is getting attached");var i={dtSettings:this._dtSettings},o=this.conditions(n);if(!o)return!1;var s;"string"==typeof n?(s=n.endsWith(".dt")?n:o.event,this._dtApi.on(s,i,t.structureHash.bind(t))):$.isArray(n)&&n.length>0?$.each(n,function(n,i){if(i.endsWith(".dt"))s=i;else{if("undefined"==typeof o[i])throw new Error("Unknown condition specified: "+i);s=o[i].event}e._dtApi.on(s+"."+e._eventNamespace,t.structureHash.bind(t))}):console.warn("Illegal parameter type for KeepConditions.attachEvent(), should be array or string, was: "+("undefined"==typeof n?"undefined":_typeof(n)))}},{key:"processHash",value:function(){var n=this;$.each(t.queryString(),function(t,e){($.isArray(e)||$.isPlainObject(e))&&(e=e[0]),t===n._tableId&&($.each(e.split(":"),function(t,e){var i=e.charAt(0),o=e.substring(1),s=n.nameByKey(i),a=n.conditions()[s];if(-1!==$.inArray(s,n.getEnabledConditions()))return"undefined"==typeof a?void console.warn("[keepConditions:' "+n._tableId+"] No condition object found for condition key:",i):void a.onLoad(o)}),n._drawTable())})}},{key:"enableCondition",value:function(n,e){var i=this,o=!1;$.isArray(n)?$.each(n,function(t,n){1===n.length&&(n=i.nameByKey(n)),i.conditions(n)!==!1&&(i._enabledConditions.push(n),o=!0)}):"string"==typeof n&&(1===n.length&&(n=this.nameByKey(n)),this.conditions(n)!==!1&&(this._enabledConditions.push(n),o=!0)),e===!0&&o===!0&&t.structureHash(this._dtSettings,!1)}},{key:"disableCondition",value:function(n,e){var i=this,o=!1;$.isArray(n)?$.each(n,function(t,n){1===n.length&&(n=i.nameByKey(n)),i.conditions(n)!==!1&&(i._enabledConditions.splice($.inArray(n,i._enabledConditions),1),o=!0)}):"string"==typeof n&&(1===n.length&&(n=this.nameByKey(n)),this.conditions(n)!==!1&&(this._enabledConditions.splice($.inArray(n,this._enabledConditions),1),o=!0)),e===!0&&o===!0&&t.structureHash(this._dtSettings,!1)}},{key:"getEnabledConditions",value:function(){return this._enabledConditions.length>0?$.unique(this._enabledConditions):!1}},{key:"nameByKey",value:function(t){return this._keysToCons[t]||!1}},{key:"conditions",value:function n(t){var e=this,i=this,n={search:{key:"f",event:"search.dt",isInit:function(){return"undefined"==typeof i._dtSettings.oInit.searching||i._dtSettings.oInit.searching!==!1},onLoad:function(t){"undefined"!=typeof t&&i._dtApi.search()!==decodeURIComponent(t)&&(i._dtApi.search(decodeURIComponent(t)),i._shouldDraw=!0)},isset:function(){return 0!==i._dtApi.search().length},newHashVal:function(){return encodeURIComponent(i._dtApi.search())}},length:{key:"l",event:"length.dt",isInit:function(){return!(i._dtSettings.oInit.lengthChange===!1||"undefined"==typeof i._dtSettings.oInit.lengthChange&&i._dtDefaults.bLengthChange===!1)},onLoad:function(t){"undefined"!=typeof t&&(i._dtApi.page.len(parseInt(t)),i._shouldDraw=!0)},isset:function(){return i._dtApi.page.len()&&i._dtApi.page.len()!==(i._dtSettings.oInit.pageLength||i._dtDefaults.iDisplayLength)},newHashVal:function(){return i._dtApi.page.len()}},page:{key:"p",event:"page.dt",isInit:function(){return!(i._dtSettings.oInit.paging===!1||"undefined"==typeof i._dtSettings.oInit.paging&&i._dtDefaults.bPaginate===!1)},onLoad:function(t){"undefined"!=typeof t&&0!==parseInt(t)&&(i._dtApi.page(parseInt(t)),i._shouldDraw=!0)},isset:function(){return i._dtApi.page.info()&&0!==i._dtApi.page.info().page},newHashVal:function(){return i._dtApi.page.info().page}},colvis:{key:"v",event:"column-visibility.dt",isInit:function(){return!0},onLoad:function(t){if("undefined"!=typeof t){var n=function(){var n=t.charAt(0),e=t.substring(1).split(".");return"f"!==n&&"t"!==n?(console.warn("Unknown ColVis condition visibility value, expected t or f, found:",n),{v:void 0}):(i._dtApi.columns().indexes().each(function(t,o){"t"===n?-1===$.inArray(t.toString(),e)?i._dtApi.column(t).visible(!1):i._dtApi.column(t).visible(!0):-1===$.inArray(t.toString(),e)?i._dtApi.column(t).visible(!0):i._dtApi.column(t).visible(!1)}),void(i._shouldDraw=!0))}();if("object"===("undefined"==typeof n?"undefined":_typeof(n)))return n.v}},isset:function(){return i._dtApi.columns().visible().filter(function(t){return!t}).any()},newHashVal:function(){var t=[],n=[];return i._dtApi.columns().visible().each(function(e,i){e===!0?t.push(i):n.push(i)}),t.length>=n.length?"f"+n.join("."):"t"+t.join(".")}},scroller:{key:"s",event:"draw.dt",isInit:function(){return"undefined"!=typeof i._dtSettings.oScroller},onLoad:function(t){0!==parseInt(t)&&i._dtApi.row(parseInt(t)).scrollTo()},isset:function(){return 0!==Math.trunc(parseInt(i._dtSettings.oScroller.s.baseRowTop))},newHashVal:function(){var t=Math.trunc(parseInt(i._dtSettings.oScroller.s.baseRowTop));return 0!==t?t:!1}},colorder:{key:"c",event:"column-reorder.dt",isInit:function(){return"undefined"!=typeof i._dtSettings._colReorder},onLoad:function(t){var n=t.split("."),e=[];$.each(n,function(t,n){if(-1!==n.indexOf("-")){var i=n.split("-"),o=parseInt(i[0]),s=parseInt(i[1]);if(o>s)for(var a=o;a+1>s;a--)e.push(a);else for(var a=o;s>a-1;a++)e.push(a)}else e.push(n)});var o=e.map(function(t){return parseInt(t)});return"undefined"==typeof i._dtApi.colReorder?!1:void(JSON.stringify(o)!==JSON.stringify(i._dtApi.colReorder.order())&&(i._dtApi.colReorder.order(o,!0),i._shouldDraw=!0))},isset:function(){return"undefined"==typeof i._dtApi.colReorder?!1:JSON.stringify(i._dtApi.colReorder.order())!==JSON.stringify(i._dtApi.columns().indexes().toArray())},newHashVal:function(){var t=i._dtApi.colReorder.order(),n=void 0,e=[],o=[],s=function(t){return o[o.length-t]},a=function(){var t=void 0;return t=2===o.length?o[0]+"."+o[1]:o[0]+"-"+s(1),o=[],t};return $.each(t,function(t,i){i=parseInt(i),"undefined"==typeof n?e.push(i):o.length>0?s(1)>s(2)&&i===s(1)+1?o.push(i):s(1)<s(2)&&i===s(1)-1?o.push(i):(e.push(a()),e.push(i)):i===n+1||i===n-1?(e.splice(e.length-1,1),o.push(n),o.push(i)):e.push(i),n=i}),o.length>0&&e.push(a()),e.join(".")}},order:{key:"o",event:"order.dt",isInit:function(){var t=!1;return $.each(e._dtSettings.aoColumns,function(n,e){return e.bSortable===!0?(t=!0,!1):void 0}),t},onLoad:function(t){if("undefined"!=typeof t){var n={a:"asc",d:"desc"};i._dtApi.order([parseInt(t.substring(1)),n[t.charAt(0)]]),i._shouldDraw=!0}},isset:function(){return i._dtApi.order()[0]&&JSON.stringify(i._dtApi.order())!==JSON.stringify($.fn.dataTable.defaults.aaSorting)},newHashVal:function(){return i._dtApi.order()[0][1].charAt(0)+i._dtApi.order()[0][0]}}};if("string"==typeof t)return"undefined"==typeof n[t]?!1:n[t];if($.isArray(t)&&t.length>0){var o={};return $.each(t,function(t,e){if("undefined"==typeof n[e])throw new Error("Unable to retrieve condition by name: "+e);o[e]=n[e]}),o}return n}}],[{key:"queryString",value:function e(){for(var e={},t=window.location.hash.substring(1),n=t.split("&"),i=0;i<n.length;i++){var o=n[i].split("=");"undefined"==typeof e[o[0]]?e[o[0]]=o[1]:"string"==typeof e[o[0]]?e[o[0]]=[e[o[0]],o[1]]:e[o[0]].push(o[1])}return e||!1}},{key:"structureHash",value:function(n,e){var i;if(!n)throw new Error("Illegal execution of KeepConditions.structureHash()");if(n instanceof t)i=n.dtSettings();else if("undefined"!=typeof n.type&&"undefined"!=typeof n.data.dtSettings)i=n.data.dtSettings;else if(n instanceof $.fn.dataTable.Api)i=n.settings()[0];else if($.fn.DataTable.isDataTable(n))i=new $.fn.dataTable.Api(n).settings()[0];else{if(!$.isPlainObject(n)||!_typeof($.isPlainObject(n.oKeepConditions)))throw new Error("Unable to determine what you passed to KeepConditions.structureHash(), should be either an instance of KeepConditions, a proper jQuery event, or a DataTable instance with keepConditions enabled");i=n}var o=new $.fn.dataTable.Api(i),s=(i.oInit,i.oKeepConditions.getEnabledConditions()),a=t.queryString(),r=$(o.table().node()).attr("id"),d={},u=[],c=[];if("undefined"==typeof s||s===!1)throw new Error("Couldn't get conditions from table settings");$.each(a,function(t,n){(t||n)&&t!==r&&(d[t]=n||"")}),$.each(s,function(t,n){if(i.oKeepConditions.conditions()[n].isset()){var e=i.oKeepConditions.conditions()[n].newHashVal();"undefined"!=typeof e&&e!==!1&&u.push(i.oKeepConditions.conditions()[n].key+e)}}),d[r]=u.join(":"),$.each(d,function(t,n){n.length>0&&c.push(t+"="+n)});var l=c.join("&");return e===!0?l:void(window.location.hash=l||"_")}}]),t}();!function(t,n,e,i){e.extend(!0,e.fn.dataTable.defaults,{language:{keepConditions:{button:{btnCopyTitle:"URL Copied",btnCopyBody:"The URL with the DataTables conditions has been copied to your clipboard",btnSelectTitle:"Copy URL",btnSelectBody:"Copy be below input to easily share the URL"}}}}),e(n).on("init.dt",function(t,n){"dt"===t.namespace&&n.oInit.keepConditions!==i&&new KeepConditions(n)}),e.fn.dataTable.Api.register("keepConditions.attachEvents()",function(t){return this.iterator("table",function(t){return t.oKeepConditions.attachEvents()})}),e.fn.dataTable.Api.register("keepConditions.detachEvents()",function(t){return this.iterator("table",function(t){return t.oKeepConditions.detachEvents()})}),e.fn.dataTable.Api.register("keepConditions.structureHash()",function(t){return this.context[0].oKeepConditions.structureHash(t)}),e.fn.dataTable.Api.register("keepConditions.enableCondition()",function(t,n){return this.iterator("table",function(e){return e.oKeepConditions.enableCondition(t,n)})}),e.fn.dataTable.Api.register("keepConditions.disableCondition()",function(t,n){return this.iterator("table",function(e){return e.oKeepConditions.disableCondition(t,n)})}),e.fn.dataTable.ext.buttons.copyConditions={text:"Copy Conditions",action:function(i,o,s,a){var r,d=o.settings()[0].oLanguage.keepConditions,u=o.settings()[0].oKeepConditions.structureHash(!0),c=n.location.protocol+"//"+n.location.host+(n.location.port.length?":"+n.location.port:"")+n.location.pathname+"#"+u,l={btnNoHashTitle:d.btnNoHashTitle||"No Conditions",btnNoHashBody:d.btnNoHashBody||"Thre are no conditions to be copied",btnCopyTitle:d.btnCopyTitle||"URL Copied",btnCopyBody:d.btnCopyBody||"The URL with the DataTables conditions has been copied to your clipboard",btnSelectTitle:d.btnSelectTitle||"Copy URL",btnSelectBody:d.btnSelectBody||"Copy be below input to easily share the URL"};if(!u)return void o.buttons.info(l.btnNoHashTitle,l.btnNoHashBody,3e3);e("<input />").val(c).attr("id","copyConditions-text").css({position:"absolute",left:"-9999px",top:(t.pageYOffset||n.documentElement.scrollTop)+"px"}).appendTo("body"),e("#copyConditions-text").select();try{n.execCommand("copy"),o.buttons.info(l.btnCopyTitle,l.btnCopyBody,a.copyTimeout||4e3),r=!0}catch(f){o.buttons.info(l.btnSelectTitle,l.btnSelectBody+'<br><input id="keepConditions-input" value="'+c+'" style="width:90%;">',a.selectTimeout||1e4),e("input#keepConditions-input").select()}finally{e("#copyConditions-text").remove()}}}}(window,document,jQuery);